<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Prueba de Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Probando la conexión a Supabase...</h1>
    <p id="status">Iniciando...</p>

    <script>
        const SUPABASE_URL = 'https://hppzwfwtedghpsxfonoh.supabase.co';
        // Asegúrate de que esta es la clave ANON correcta y funcional
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhwcHp3Znd0ZWRnaHBzeGZvbm9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMjQzNDMsImV4cCI6MjA2OTcwMDM0M30.BAh6i5iJ5YkDBoydfkC9azAD4eMdYBkEBdxws9kj5Hg';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const statusEl = document.getElementById('status');

        supabase.auth.onAuthStateChange(async (event, session) => {
            if (session) {
                statusEl.textContent = `Sesión encontrada para ${session.user.email}. Verificando rol...`;
                try {
                    const { data: profile, error } = await supabase
                        .from('profiles')
                        .select('role')
                        .eq('id', session.user.id)
                        .single();

                    if (error) throw error;

                    if (profile) {
                        statusEl.textContent = `¡ÉXITO! Tu rol es: ${profile.role}`;
                        statusEl.style.color = 'green';
                    } else {
                        statusEl.textContent = 'ERROR: No se encontró un perfil para tu usuario.';
                        statusEl.style.color = 'red';
                    }
                } catch (err) {
                    statusEl.textContent = `ERROR en la consulta: ${err.message}`;
                    statusEl.style.color = 'red';
                }
            } else {
                statusEl.textContent = 'No hay sesión. Por favor, inicia sesión en la app principal primero y luego ven aquí.';
            }
        });
    </script>
</body>
</html>